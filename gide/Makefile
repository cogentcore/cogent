# Basic Go makefile

GOCMD=go
GOBUILD=$(GOCMD) build
GOCLEAN=$(GOCMD) clean
GOTEST=$(GOCMD) test
GOGET=$(GOCMD) get


all: build

build: 
	$(GOBUILD) -v
test: 
	$(GOTEST) -v ./...
clean: 
	$(GOCLEAN)

VERS=`git describe --always --tags`
VERS_LONG=`git describe --always --long`
VERS_DATE=`date -u +%Y-%m-%d\ %H:%M`
VERS_FILE=version.go

version:
	/bin/rm -f $(VERS_FILE)
	@echo "// WARNING: auto-generated by Makefile version target -- run 'make version' to update" > $(VERS_FILE)
	@echo "package gide" >> $(VERS_FILE)
	@echo "const (" >> $(VERS_FILE)
	@echo "	Version = \"$(VERS)\"" >> $(VERS_FILE)
	@echo "	VersionLong = \"$(VERS_LONG)\"" >> $(VERS_FILE)
	@echo "	VersionDate = \"$(VERS_DATE)\"" >> $(VERS_FILE)
	@echo ")" >> $(VERS_FILE)
	@echo "" >> $(VERS_FILE)
	/bin/cat $(VERS_FILE)


